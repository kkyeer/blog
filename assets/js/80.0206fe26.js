(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{604:function(s,t,a){"use strict";a.r(t);var n=a(6),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"配置免费https-let-s-encrypt-centos7-nginx-tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置免费https-let-s-encrypt-centos7-nginx-tomcat"}},[s._v("#")]),s._v(" 配置免费HTTPS : let's encrypt+centos7+nginx+tomcat")]),s._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("突然想给自己的基础版阿里云服务器增加https支持，折腾了许久，简单记一下")]),s._v(" "),a("h2",{attrs:{id:"获取证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取证书"}},[s._v("#")]),s._v(" 获取证书")]),s._v(" "),a("p",[s._v("1）获取certbot-auto脚本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dl.eff.org/certbot-auto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2）使certbot-auto脚本可执行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+x ./certbot-auto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("3）运行certbot-auto，安装Certbot")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("./certbot-auto certonly")]),s._v(" "),a("li",[s._v("选择2")])])]),s._v(" "),a("p",[s._v("运行完毕后，获得的私钥等在文件夹/etc/letsencrypt/live/{websiteDomain}/下，websiteDomain为申请时输入的网站名")]),s._v(" "),a("h2",{attrs:{id:"刷新证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#刷新证书"}},[s._v("#")]),s._v(" 刷新证书")]),s._v(" "),a("p",[s._v("1）Let's Encrypt的证书只有3个月期限，到期刷新")]),s._v(" "),a("div",{staticClass:"language-Shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./certbot-auto renew\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"附1-nginx-配置ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附1-nginx-配置ssl"}},[s._v("#")]),s._v(" 附1：nginx 配置ssl")]),s._v(" "),a("p",[s._v("nginx本身作为静态资源服务器，配置https需要编辑nginx/conf/nginx.conf文件，示例配置如下，将下述代码中的{websiteDomain}替换成自己的域名，比如域名是www.abc.com,则 ssl_certificate      /etc/letsencrypt/live/www.abc.com/fullchain.pem;")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    server{\n    listen 80;\n    server_name localhost;\n    #http请求转发443端口\n    rewrite ^(.*)$  https://$host$1 permanent;\n    }\n    server {\n    #增加https设置\n        listen       443 ssl;\n        server_name  localhost;\n\n        ssl_certificate      /etc/letsencrypt/live/{websiteDomain}/fullchain.pem;\n        ssl_certificate_key  /etc/letsencrypt/live/{websiteDomain}/privkey.pem;\n        ssl_session_timeout  5m;\n\n        location / {\n            root   /webroot;\n        index index.html;\n        }\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    #........省略其他设置\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h2",{attrs:{id:"附2-tomcat配置https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附2-tomcat配置https"}},[s._v("#")]),s._v(" 附2：Tomcat配置https")]),s._v(" "),a("h3",{attrs:{id:"第一步-tomcat安装apr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第一步-tomcat安装apr"}},[s._v("#")]),s._v(" 第一步：Tomcat安装apr")]),s._v(" "),a("p",[s._v("因为下一步tomcat配置https需要需要编译apr\n"),a("strong",[s._v("注意，编译过程中需要jni相关头文件，在openjdk里没有找到，所以临时安装了OracleJDK，即下述--with-java-home参数指定的路径")])]),s._v(" "),a("ol",[a("li",[s._v("安装依赖\nyum install apr-devel apr apr-util")]),s._v(" "),a("li",[s._v("解压tomcat文件夹中自带的tomcat-native源码，不需下载，在bin目录下有\ntar -xvf tomcat/bin/tomcat-native.tar.gz")]),s._v(" "),a("li",[s._v("可选：下载并解压OracleJDK到当前文件夹，步骤略")]),s._v(" "),a("li",[s._v("编译\ncd tomcat-native-1.2.16-src/native/\n./configure --prefix=/usr/local/apr --with-java-home=./jdk1.8.0_181/\n./configure && make && make install")])]),s._v(" "),a("h3",{attrs:{id:"第二步-tomcat配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第二步-tomcat配置"}},[s._v("#")]),s._v(" 第二步：Tomcat配置")]),s._v(" "),a("ul",[a("li",[a("h4",{attrs:{id:"conf-web-xml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conf-web-xml"}},[s._v("#")]),s._v(" conf/web.xml")])])]),s._v(" "),a("p",[s._v("增加如下配置")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("security-constraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("web-resource-collection")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("web-resource-name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("SSL"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("web-resource-name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("url-pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/*"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("url-pattern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("web-resource-collection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("user-data-constraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("transport-guarantee")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("CONFIDENTIAL"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("transport-guarantee")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("user-data-constraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("security-constraint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[a("h4",{attrs:{id:"conf-server-xml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conf-server-xml"}},[s._v("#")]),s._v(" conf/server.xml")])])]),s._v(" "),a("p",[s._v('将相关接口配置为https服务，将下述代码中的{websiteDomain}替换成自己的域名，比如域名是www.abc.com,则certificateKeyFile="/etc/letsencrypt/live/www.abc.com/privkey.pem",其他位置类似')]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Connector")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("12334"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.coyote.http11.Http11AprProtocol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n               "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxThreads")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("150"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("SSLEnabled")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("true"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("UpgradeProtocol")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("className")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("org.apache.coyote.http2.Http2Protocol"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("SSLHostConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("Certificate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("certificateKeyFile")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/etc/letsencrypt/live/{websiteDomain}/privkey.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("certificateFile")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/etc/letsencrypt/live/{websiteDomain}/cert.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("certificateChainFile")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/etc/letsencrypt/live/{websiteDomain}/chain.pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v("\n                         "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("RSA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("SSLHostConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("Connector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"附4-自签名openssl-证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附4-自签名openssl-证书"}},[s._v("#")]),s._v(" 附4 自签名OpenSSL 证书")]),s._v(" "),a("h3",{attrs:{id:"方式1-简单-适合快速操作-但是浏览器无法信任"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式1-简单-适合快速操作-但是浏览器无法信任"}},[s._v("#")]),s._v(" 方式1：简单，适合快速操作，但是浏览器无法信任")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("openssl genrsa -des3 -out ca.key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl rsa -in ca.key -out ca.key.nopass\nopenssl req -new -key ca.key.nopass -out server.csr\nopenssl x509 -req -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -in server.csr -signkey ca.key.nopass -out server.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"方式2-全面-适合需要信任自签名证书的场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式2-全面-适合需要信任自签名证书的场景"}},[s._v("#")]),s._v(" 方式2：全面，适合需要信任自签名证书的场景")]),s._v(" "),a("p",[s._v("参考："),a("a",{attrs:{href:"https://icoolworld.github.io/chrome%E5%AF%BC%E5%85%A5CA%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%90%8E-%E6%8F%90%E7%A4%BASubject-Alternative-Name-Missing%E9%97%AE%E9%A2%98.html#2%E5%88%9B%E5%BB%BA%E8%87%AA%E7%AD%BE%E5%90%8D%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%81%E4%B9%A6createselfsignedcertificatesh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Chrome导入ca根证书后 提示subject Alternative Name Missing问题"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("新建 createCAkey.sh")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\nopenssl genrsa -des3 -out rootCA.key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl req -x509 -new -key rootCA.key.nopass -out rootCA.cer -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" -subj /CN"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MY CA"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设备上安装此CA证书并信任即可")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("执行后 创建无密码CA.key")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("openssl rsa -in rootCA.key -out rootCA.key.nopass\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输入上一步的密码")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("新建 createServerSelfSignedKey.sh")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" openssl genrsa -out server.key "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" openssl req -new -sha256 -nodes -out server.csr -key server.key -config server.csr.cnf\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" openssl x509 -req -in server.csr -CA "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/rootCA.cer -CAkey "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/rootCA.key.nopass -CAcreateserial -CAserial serial -out server.cer -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" -sha256 -extfile v3.ext\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("v3.ext")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("authorityKeyIdentifier")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("keyid,issuer\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("basicConstraints")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CA:FALSE\nkeyUsage "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nsubjectAltName "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" @alt_names\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("alt_names"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDNS.1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOME_DOMAIN_TO_BE_REPLACED\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("server.csr.cnf")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault_bits "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nprompt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\ndefault_md "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sha256\ndistinguished_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" dn\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("C")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("US\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("New York\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("L")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Rochester\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("O")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("End Point\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OU")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Testing Domain\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("emailAddress")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("EMAIL_TO_BE_REPLACED\nCN "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SOME_DOMAIN_TO_BE_REPLACED\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("注意: iOS安装完成CA证书后，安装成功并未授信证书, 需要到 设置 ---\x3e 通用 ---\x3e 关于本机 ---\x3e 证书信任设置 下对证书开启完全信任")])])}),[],!1,null,null,null);t.default=e.exports}}]);